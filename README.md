# Backtest Engine

A modular backtesting framework for evaluating trading strategies on historical market data. Designed for quantitative developers and algorithmic traders, this engine allows seamless integration of custom strategies, risk management, and portfolio tracking, with results exportable for further analysis.

---

## Features

- **Event-driven architecture**: Processes `MarketEvent`, `OrderEvent`, and `FillEvent` objects to simulate realistic market behavior.
- **Strategy interface**: Define custom trading strategies by inheriting from the `Strategy` base class.
- **Portfolio management**: Tracks cash, positions, and equity dynamically.
- **Risk management hooks**: Optional `RiskManager` to control order execution.
- **Metrics tracking**: Time-series portfolio equity is recorded and exportable to CSV.
- **Extensible and modular**: Easily add new asset types, events, or strategies.

---

## Architecture

### Event System

The engine operates on three core event types:

1. **MarketEvent**: Represents a market data update, such as price changes.
2. **OrderEvent**: Generated by strategies to indicate an intention to buy/sell.
3. **FillEvent**: Represents executed trades and updates the portfolio accordingly.

Events are processed sequentially. Strategies react to `MarketEvent`s to produce `OrderEvent`s, which are then converted into `FillEvent`s.

### Strategy Interface

All strategies inherit from the abstract `Strategy` class and implement:

```cpp
virtual void on_market_event(
    const MarketEvent& e, 
    Portfolio& portfolio, 
    std::vector<std::shared_ptr<OrderEvent>>& orders
) = 0;


	on_market_event: Triggered whenever new market data arrives.
	•	Portfolio: Provides access to cash, positions, and trading functions.
	•	orders: Output vector where new OrderEvents are appended.

Example: BuyAndHoldStrategy buys fixed quantities of selected assets at the first timestep and holds them.

Portfolio
	•	Tracks cash, positions, and overall equity.
	•	Updates positions on FillEvents and recalculates equity per timestep.
	•	Provides utility methods:
	•	buy(symbol, quantity, price)
	•	sell(symbol, quantity, price)
	•	apply_fill(FillEvent& e)
	•	mark_to_market(MarketEvent& e)

Metrics
	•	Tracks equity evolution over time.
	•	Exportable to CSV using:

    metrics.export_to_csv("../results/results.csv");

TimeStep,Equity
0,66719.5
1,44629.5
...